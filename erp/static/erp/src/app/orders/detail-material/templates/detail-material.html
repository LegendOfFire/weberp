<ngb-tabset>
  <ngb-tab title="总计需求">
    <template ngbTabContent>
      <table class="table">
        <tr>
          <th scope="col"></th>
          <!--<th>名称/单位</th>-->
          <th>一级</th>
          <th>二级</th>
          <th>总计需求</th>
          <th>在库数量</th>
          <th>未入库(采购中)</th>
        </tr>
        <tr *ngFor="let material of materialItemList; let i = index">
          <th>{{i+1}}</th>
          <td>{{getParentName(material.materialId)}}</td>
          <td>{{material.name}}</td>
          <td>{{material.requrimentNum}}</td>
          <td>{{material.instockNum}}</td>
          <td>{{material.shoppingNum}}</td>
        </tr>
      </table>
    </template>
  </ngb-tab>

  <ngb-tab *ngFor="let product of productList; let i = index" title={{product.name}}>
    <template ngbTabContent>
      <div class="row">
        <div class="col-sm-8"></div>
        <div class="col-sm-4" *ngIf="materialItemtEditable">
          <button class="btn btn-primary" (click)="onSubmitEdit(i)">完成</button>
          <button class="btn btn-primary" (click)="onCancelEdit(i)">撤销</button>
        </div>
        <div class="col-sm-2" *ngIf="!materialItemtEditable">
          <button class="btn btn-primary" (click)="onEdit(i)">编辑</button>
        </div>
      </div>

      <table class="table">
        <tr>
          <ng-container *ngIf="!materialItemtEditable">
            <th scope="col"></th>
            <th>一级</th>
            <th>二级</th>
            <th>单位</th>
            <th>数量</th>
          </ng-container>

          <ng-container *ngIf="materialItemtEditable">
            <th scope="col"></th>
            <th></th>
            <th>一级</th>
            <th>二级</th>
            <th>单位</th>
            <th>数量</th>
            <th></th>
          </ng-container>
        </tr>
        <ng-container *ngIf="!materialItemtEditable">
          <tr *ngFor="let material of product.materialRequrimentList; let j = index">
            <th>{{j+1}}</th>
            <td>{{getParentName(material.materialId)}}</td>
            <td>{{material.name}}</td>
            <td>{{material.unit}}</td>
            <td>{{material.count}}</td>
          </tr>
        </ng-container>
        <ng-container *ngIf="materialItemtEditable">
          <tr *ngFor="let material of product.materialRequrimentList; let j = index">
            <th><button type="button" class="btn btn-danger btn-sm" (click)="onDelete(i,j)"><i class="fa fa-minus"></i></button></th>
            <th>{{j+1}}</th>
            <td>{{getParentName(material.materialId)}}</td>
            <td>{{material.name}}</td>
            <td>{{material.unit}}</td>
            <td><input class="form-control user-input" [(ngModel)]="material.count"></td>
          </tr>
          <tr>
            <th></th>
            <!--<td>
              <ng-container *ngIf="choose_leaf?.name">
                <td><h2>{{choose_leaf.name}}</h2></td>
              </ng-container>
              <dropdown-tree-view [root_node]="mateialTree" (choose_leaf)="onChooseLeaf($event)"></dropdown-tree-view>
            </td>-->
            <th>{{product.materialRequrimentList.length + 1}}</th>

            <td><select class="custom-select" [ngModel]="material_level1" (ngModelChange)="onChangeLevel1($event)">
        <ng-container *ngIf="material_level1">
          <option [ngValue]="l1" *ngFor="let l1 of material_level1">{{l1.name}}</option>
        </ng-container>
        </select></td>

              <td><select class="custom-select" [ngModel]="material_level2" (ngModelChange)="onChangeLevel2($event)">
        <ng-container *ngIf="material_level2">
          <option selected [ngValue]="l2" *ngFor="let l2 of material_level2">{{l2.name}}</option>
        </ng-container>
        </select></td>

            <!--<td><input class="form-control user-input" [(ngModel)]="newMaterialName"></td>-->
            <!--<td><input class="form-control user-input" [(ngModel)]="newMaterialUnit"></td>-->
      <ng-container *ngIf="selected_material != undefined">
        <td>{{selected_material.unit}}</td>
      </ng-container>
      <ng-container *ngIf="selected_material == undefined">
        <td>N/A</td>
      </ng-container>
            <td><input class="form-control user-input" [(ngModel)]="newMaterialNumber"></td>
            <td><button type="button" class="btn btn-success btn-sm" (click)="onAdd(newMaterialNumber,i)"><i class="fa fa-plus"></i></button></td>
          </tr>

        </ng-container>
      </table>
    </template>
  </ngb-tab>
</ngb-tabset>
